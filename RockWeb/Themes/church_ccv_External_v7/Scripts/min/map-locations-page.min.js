!function(){function o(){CCV.mapStyles=[{stylers:[{visibility:"simplified"},{saturation:-100}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"on"},{gamma:3.05}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"administrative.country",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"off"}]},{}],CCV.mapType=new google.maps.StyledMapType(CCV.mapStyles),CCV.markerFile=window.devicePixelRatio>1.5?"http://ccv.church/Assets/Images/marker@2x.png":"http://ccv.church/Assets/Images/marker.png",CCV.marker=new google.maps.MarkerImage(CCV.markerFile,null,null,null,new google.maps.Size(30,38)),CCV.baseMap=function(o,t){this.holder=o,this.points=t,this.markers=[],this.bounds=new google.maps.LatLngBounds,this.zoom=this.zoom||12,this.useZoom=this.useZoom||!1,this.useScrollZoom=this.useScrollZoom||!0,this.usePanControl=this.usePanControl||!0},CCV.baseMap.prototype={draw:function(){var o={};if(o=this.useScrollZoom?{mapTypeId:"CCV",disableDefaultUI:!0}:{mapTypeId:"CCV",scrollwheel:!1,panControl:this.usePanControl,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!1,mapTypeControl:!1},this.mapOptions=this.mapOptions||o,!this.holder)throw"Can't find map holder";this.map=new google.maps.Map(this.holder,this.mapOptions),this.map.mapTypes.set("CCV",CCV.mapType),this.dropMarkers(),this.fitMarkers(),this.bindUi()},dropMarkers:function(){for(var o=0;o<this.points.length;o++){var t=this.points[o];this.dropMarker(t)}},dropMarker:function(o){var t=new google.maps.Marker({position:new google.maps.LatLng(o.lat,o.lng),icon:CCV.marker,map:this.map,title:o.title,animation:google.maps.Animation.DROP});this.markers.push(t),this.bounds.extend(t.position),this.afterDropMarker.call(this,o,t)},afterDropMarker:function(o,t){},fitMarkers:function(){this.map.setCenter(this.bounds.getCenter()),this.useZoom||1==this.markers.length?this.map.setZoom(this.zoom):this.map.fitBounds(this.bounds)},bindUi:function(){var o=this;$(window).resize(function(){o.fitMarkers()})},getInstanceName:function(){for(var o in window)if(window[o]==this)return o}},CCV.campusMap=function(o,t){CCV.baseMap.call(this,o,t),this.campusToDraw=t||"all"},CCV.campusMap.prototype=new CCV.baseMap,CCV.campusMap.prototype.constructor=CCV.campusMap,CCV.campusMap.prototype.dropMarkers=function(){if("all"==this.campusToDraw)for(var o=0;o<CCV.locations.length;o++){var t=CCV.locations[o];this.dropMarker(t)}else{var t=CCV.findCampusById(this.campusToDraw);this.dropMarker(t),this.useZoom=!0}},CCV.campusMap.prototype.dropMarker=function(o){var t=new google.maps.Marker({position:new google.maps.LatLng(o.geo.lat,o.geo.lng),icon:CCV.marker,map:this.map,title:o.name,campusid:o.id,animation:google.maps.Animation.DROP});this.markers.push(t),this.bounds.extend(t.position),this.afterDropMarker.call(this,o,t)},CCV.campusInfoWindowMap=function(o,t){CCV.campusMap.call(this,o,t),this.infowindow=new google.maps.InfoWindow({content:"Loading..."})},CCV.campusInfoWindowMap.prototype=new CCV.campusMap,CCV.campusInfoWindowMap.prototype.constructor=CCV.campusInfoWindowMap,CCV.campusInfoWindowMap.prototype.afterDropMarker=function(o,t){var i=this;google.maps.event.addListener(t,"click",function(){i.infowindow.setContent(i.buildInfoWindow(o)),i.infowindow.open(i.map,this)})},CCV.campusInfoWindowMap.prototype.buildInfoWindow=function(o){var t;return t='<div class="infowindow">',t+='  <div class="name">'+o.name+" Campus</div>",t+='  <div class="group">',t+='    <img class="photo" src="'+o.photo+'&width=75" style="width: 75px; height: 75px;">',t+='    <div class="details">',t+='      <span class="address">'+o.street+"<br>"+o.city+", "+o.state+" "+o.zip+"</span>",t+='      <span class="phone">'+o.phone+"</span>",t+="    </div>",t+="  </div>","function"==typeof this.selectCampus&&(t+='  <a class="select" onclick="'+this.getInstanceName()+".selectCampus("+o.id+')">Select this Campus</a>'),t+="</div>"},CCV.campusInfoWindowMapGeo=function(o,t){CCV.campusInfoWindowMap.call(this,o,t),this.infowindow=new google.maps.InfoWindow({content:"Loading..."})},CCV.campusInfoWindowMapGeo.prototype=new CCV.campusInfoWindowMap,CCV.campusInfoWindowMapGeo.prototype.constructor=CCV.campusInfoWindowMapGeo,CCV.campusInfoWindowMapGeo.prototype.findNearestCampus=function(o,t){function i(t,i){if(i==google.maps.DistanceMatrixStatus.OK){for(var e,n,r=Number.POSITIVE_INFINITY,p=t.rows[0].elements,l=0;l<p.length;l++)n=p[l].duration.value,r>n&&(r=n,e=l);s.removeClass("is-loading"),a.nearestCampus=CCV.locations[e],"function"==typeof o&&o.call(a,a.nearestCampus)}}var e,a=this,s=$(t),n=new google.maps.DistanceMatrixService;navigator.geolocation&&(s.addClass("is-loading"),navigator.geolocation.getCurrentPosition(function(o){e=new google.maps.LatLng(o.coords.latitude,o.coords.longitude),n.getDistanceMatrix({origins:[e],destinations:a.allLocationsGeoArray(),travelMode:google.maps.TravelMode.DRIVING},i)}))},CCV.campusInfoWindowMapGeo.prototype.allLocationsGeoArray=function(){for(var o=[],t=0;t<CCV.locations.length;t++){var i=CCV.locations[t].geo,e=new google.maps.LatLng(i.lat,i.lng);o.push(e)}return o},CCV.campusInfoWindowMapGeo.prototype.openInfoWindow=function(o){var t=this.markers.filter(function(t){return t.campusid==o.id})[0];this.infowindow.setContent(this.buildInfoWindow(o)),this.infowindow.open(this.map,t)}}window.CCV=window.CCV||{},"object"==typeof google&&"object"==typeof google.maps?o():$(window).on("googleMapsIsLoaded",function(){o()})}();
Rock.controls.util.loadGoogleMapsApi("https://maps.googleapis.com/maps/api/js?sensor=true&libraries=drawing"),$(window).on("googleMapsIsLoaded",function(){function o(o,t){var a=document.createElement("div");a.className="btn btn-default btn-primary",a.title="Click to find the nearest campus to you",a.innerHTML='<i class="fa fa-fw fa-location-arrow"></i> Find Nearest Campus',o.appendChild(a),google.maps.event.addDomListener(a,"click",function(){locationsMap.findNearestCampus(locationsMap.openInfoWindow,this)})}function t(o,t){var a=document.createElement("div");a.className="btn btn-default btn-md",a.title="Zoom In",a.innerHTML='<i class="fa fa-fw fa-plus"></i>',o.appendChild(a),google.maps.event.addDomListener(a,"click",function(){locationsMap.map.setZoom(locationsMap.map.getZoom()+1)});var e=document.createElement("div");e.className="btn btn-default btn-md",e.title="Zoom Out",e.innerHTML='<i class="fa fa-fw fa-minus"></i>',o.appendChild(e),google.maps.event.addDomListener(e,"click",function(){locationsMap.map.setZoom(locationsMap.map.getZoom()-1)})}window.locationsMap=new CCV.campusInfoWindowMapGeo(document.getElementById("locationsmap")),locationsMap.selectCampus=function(o){alert(o)},locationsMap.buildInfoWindow=function(o){var t;return t='<div class="infowindow">',t+='  <div class="name">'+o.name+" Campus</div>",t+='  <div class="group">',t+='    <img class="photo" src="'+o.photo+'&width=75" style="width: 75px; height: 75px;">',t+='    <div class="details">',t+='      <span class="address">'+o.street+"<br>"+o.city+", "+o.state+" "+o.zip+"</span>",t+='      <span class="phone">'+o.phone+"</span>",t+="    </div>",t+="  </div>","function"==typeof this.selectCampus&&(t+='  <a class="select" href="'+o.url+'">Learn More</a>'),t+="</div>"},locationsMap.mapOptions={mapTypeId:"CCV",scrollwheel:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,mapTypeControl:!1},locationsMap.draw();var a=document.createElement("div");a.style.marginTop="2.5%",a.style.marginLeft="2.5%";new o(a,locationsMap.map);a.index=1,locationsMap.map.controls[google.maps.ControlPosition.TOP_LEFT].push(a);var e=document.createElement("div");e.className="btn-group-vertical",e.style.marginTop="2.5%",e.style.marginRight="2.5%";new t(e,locationsMap.map);e.index=1,locationsMap.map.controls[google.maps.ControlPosition.RIGHT_TOP].push(e)});
