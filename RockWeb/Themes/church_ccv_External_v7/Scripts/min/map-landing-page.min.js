!function(){function e(){CCV.mapStyles=[{stylers:[{visibility:"simplified"},{saturation:-100}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"on"},{gamma:3.05}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"administrative.country",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"off"}]},{}],CCV.mapType=new google.maps.StyledMapType(CCV.mapStyles),CCV.markerFile=window.devicePixelRatio>1.5?"http://www.ccvonline.com/Arena/Content/v6/img/maps/marker@2x.png":"http://www.ccvonline.com/Arena/Content/v6/img/maps/marker.png",CCV.marker=new google.maps.MarkerImage(CCV.markerFile,null,null,null,new google.maps.Size(30,38)),CCV.baseMap=function(e,t){this.holder=e,this.points=t,this.markers=[],this.bounds=new google.maps.LatLngBounds,this.zoom=this.zoom||12,this.useZoom=this.useZoom||!1,this.useScrollZoom=this.useScrollZoom||!0},CCV.baseMap.prototype={draw:function(){var e={};if(e=this.useScrollZoom?{mapTypeId:"CCV",disableDefaultUI:!0}:{mapTypeId:"CCV",scrollwheel:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!1,mapTypeControl:!1},this.mapOptions=this.mapOptions||e,!this.holder)throw"Can't find map holder";this.map=new google.maps.Map(this.holder,this.mapOptions),this.map.mapTypes.set("CCV",CCV.mapType),this.dropMarkers(),this.fitMarkers(),this.bindUi()},dropMarkers:function(){for(var e=0;e<this.points.length;e++){var t=this.points[e];this.dropMarker(t)}},dropMarker:function(e){var t=new google.maps.Marker({position:new google.maps.LatLng(e.lat,e.lng),icon:CCV.marker,map:this.map,title:e.title,animation:google.maps.Animation.DROP});this.markers.push(t),this.bounds.extend(t.position),this.afterDropMarker.call(this,e,t)},afterDropMarker:function(e,t){},fitMarkers:function(){this.map.setCenter(this.bounds.getCenter()),this.useZoom||1==this.markers.length?this.map.setZoom(this.zoom):this.map.fitBounds(this.bounds)},bindUi:function(){var e=this;$(window).resize(function(){e.fitMarkers()})},getInstanceName:function(){for(var e in window)if(window[e]==this)return e}},CCV.campusMap=function(e,t){CCV.baseMap.call(this,e,t),this.campusToDraw=t||"all"},CCV.campusMap.prototype=new CCV.baseMap,CCV.campusMap.prototype.constructor=CCV.campusMap,CCV.campusMap.prototype.dropMarkers=function(){if("all"==this.campusToDraw)for(var e=0;e<CCV.locations.length;e++){var t=CCV.locations[e];this.dropMarker(t)}else{var t=CCV.findCampusById(this.campusToDraw);this.dropMarker(t),this.useZoom=!0}},CCV.campusMap.prototype.dropMarker=function(e){var t=new google.maps.Marker({position:new google.maps.LatLng(e.geo.lat,e.geo.lng),icon:CCV.marker,map:this.map,title:e.name,campusid:e.id,animation:google.maps.Animation.DROP});this.markers.push(t),this.bounds.extend(t.position),this.afterDropMarker.call(this,e,t)},CCV.campusInfoWindowMap=function(e,t){CCV.campusMap.call(this,e,t),this.infowindow=new google.maps.InfoWindow({content:"Loading..."})},CCV.campusInfoWindowMap.prototype=new CCV.campusMap,CCV.campusInfoWindowMap.prototype.constructor=CCV.campusInfoWindowMap,CCV.campusInfoWindowMap.prototype.afterDropMarker=function(e,t){var n=this;google.maps.event.addListener(t,"click",function(){n.infowindow.setContent(n.buildInfoWindow(e)),n.infowindow.open(n.map,this)})},CCV.campusInfoWindowMap.prototype.buildInfoWindow=function(e){var t;return t='<div class="infowindow">',t+='  <div class="name">'+e.name+" Campus</div>",t+='  <div class="group">',t+='    <img class="photo" src="'+e.photo+'&width=75" style="width: 75px; height: 75px;">',t+='    <div class="details">',t+='      <span class="address">'+e.street+"<br>"+e.city+", "+e.state+" "+e.zip+"</span>",t+='      <span class="phone">'+e.phone+"</span>",t+="    </div>",t+="  </div>","function"==typeof this.selectCampus&&(t+='  <a class="select" onclick="'+this.getInstanceName()+".selectCampus("+e.id+')">Select this Campus</a>'),t+="</div>"}}window.CCV=window.CCV||{},"object"==typeof google&&"object"==typeof google.maps?e():$(window).on("googleMapsIsLoaded",function(){e()})}();
var landingMap=new CCV.campusInfoWindowMap(document.getElementById("map-holder"));landingMap.bindUi=function(){var e=this;$(window).resize(function(){e.fitMarkers()}),$(".js-find-nearest-campus").click(function(){e.findNearestCampus(e.openInfoWindow,this)})},landingMap.selectCampus=function(e){Rock.utility.setContext("campuses",e),$(document).ajaxComplete(function(e,t,n){n.url.indexOf("/api/campuses/SetContext/")>-1&&CCV.homePageRoute&&window.location.replace("/"+CCV.homePageRoute)})},landingMap.openInfoWindow=function(e){var t=this.markers.filter(function(t){return t.campusid==e.id})[0];this.infowindow.setContent(this.buildInfoWindow(e)),this.infowindow.open(this.map,t)},landingMap.findNearestCampus=function(e,t){function n(t,n){if(n==google.maps.DistanceMatrixStatus.OK){for(var r,a,s=Number.POSITIVE_INFINITY,l=t.rows[0].elements,c=0;c<l.length;c++)a=l[c].duration.value,s>a&&(s=a,r=c);i.removeClass("is-loading"),o.nearestCampus=CCV.locations[r],"function"==typeof e&&e.call(o,o.nearestCampus)}}var r,o=this,i=$(t),a=new google.maps.DistanceMatrixService;navigator.geolocation&&(i.addClass("is-loading"),navigator.geolocation.getCurrentPosition(function(e){r=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),a.getDistanceMatrix({origins:[r],destinations:o.allLocationsGeoArray(),travelMode:google.maps.TravelMode.DRIVING},n)}))},landingMap.allLocationsGeoArray=function(){for(var e=[],t=0;t<CCV.locations.length;t++){var n=CCV.locations[t].geo,r=new google.maps.LatLng(n.lat,n.lng);e.push(r)}return e},landingMap.draw();
