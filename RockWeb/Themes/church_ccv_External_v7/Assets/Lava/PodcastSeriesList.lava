{% if rows.first.CurrentPage == 1 %}
  <header class="bigblock bigblock-flexbg bigblock-flexbg-md" style="background-image: url('http://ccv.church/Arena/cachedblob.aspx?guid={{ rows.first.MessageImageBlobId3 }}');">
  </header>
{% endif %}

<div class="container">
{% for r in rows %}

    {% if forloop.first %}
      {% comment %}New Series{% endcomment %}
      {% assign currentSeries = r.SeriesTitle  %}
      <div class="row">
        <div class="col-sm-6 col-md-4">
          <div class="thumbnail padding-b-none js-series">
            <a href="#"><img class="img-full" src="http://ccv.church/Arena/cachedblob.aspx?guid={{ r.MessageImageBlobId1 }}&amp;width=720&amp;height=720" alt="{{ r.SeriesTitle }}"></a>
            <div class="caption">
              <h3 class="panel-title">{{ r.SeriesTitle }}</h3>
            </div>
          </div>
          <div class="popover-content-holder hide">
            <span class="description">
              {{ r.MessageDescription | Truncate: 280, '...'}}
            </span>
            <hr class="margin-v-md">
            <div class="message-list list-2col-wrapper">
              <ol class="list-flush margin-b-none">
                <li class="margin-b-sm">
                  <a href="default.aspx?page=17529&amp;item={{ r.MessageId }}">{{ r.MessageTitle }}</a>
                </li>
    {% endif %}

    {% if r.SeriesTitle != currentSeries %}
      {% comment %}New Series{% endcomment %}
      {% assign currentSeries = r.SeriesTitle  %}
              </ol>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-md-4">
          <div class="thumbnail padding-b-none js-series">
            <a href="#"><img class="img-full" src="http://ccv.church/Arena/cachedblob.aspx?guid={{ r.MessageImageBlobId1 }}&amp;width=720&amp;height=720" alt="{{ r.SeriesTitle }}"></a>
            <div class="caption">
              <h3 class="panel-title">{{ r.SeriesTitle }}</h3>
            </div>
          </div>
          <div class="popover-content-holder hide">
            <span class="description">
              {{ r.MessageDescription | Truncate: 280, '...'}}
            </span>
            <hr class="margin-v-md">
            <div class="message-list list-2col-wrapper">
              <ol class="list-flush margin-b-none">
                <li class="margin-b-sm">
                  <a href="default.aspx?page=17529&amp;item={{ r.MessageId }}">{{ r.MessageTitle }}</a>
                </li>
    {% elsif r.SeriesTitle == currentSeries %}
      {% comment %}Same Series{% endcomment %}
                <li class="margin-b-sm">
                  <a href="default.aspx?page=17529&amp;item={{ r.MessageId }}">{{ r.MessageTitle }}</a>
                </li>
    {% endif %}

    {% if forloop.last %}
              </ol>
            </div>
          </div>
        </div>

      </div>
    {% endif %}

  {% endfor %}


  <nav class="text-center">
    <ul class="pagination pagination-lg">

      {% if rows.first.CurrentPage == 1  %}
        <li class="disabled">
          <span>
            <span aria-hidden="true">&laquo;</span>
          </span>
        </li>
      {% else %}
        <li><a href="?PageNum={{ rows.first.CurrentPage | Minus: 1 }}" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>
      {% endif %}

      {% if rows.first.CurrentPage > 2 %}
        <li><a href="?PageNum={{ rows.first.CurrentPage | Minus: 2 }}">{{ rows.first.CurrentPage | Minus: 2 }}</a></li>
      {% endif %}
      {% if rows.first.CurrentPage > 1 %}
        <li><a href="?PageNum={{ rows.first.CurrentPage | Minus: 1 }}">{{ rows.first.CurrentPage | Minus: 1 }}</a></li>
      {% endif %}

      <li class="active">
        <span>{{ rows.first.CurrentPage }} <span class="sr-only">(current)</span></span>
      </li>

      <li><a href="?PageNum={{ rows.first.CurrentPage | Plus: 1 }}">{{ rows.first.CurrentPage | Plus: 1 }}</a></li>
      <li><a href="?PageNum={{ rows.first.CurrentPage | Plus: 2 }}">{{ rows.first.CurrentPage | Plus: 2 }}</a></li>

      <li><a href="?PageNum={{ rows.first.CurrentPage | Plus: 1 }}" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>

    </ul>
  </nav>


</div>

<script>
  // Keep popover open when hovering on popover, not trigger
  // Modified from http://jsfiddle.net/WojtekKruszewski/Zf3m7/22/
  // Requires a hide delay on the popover
  var originalLeave = $.fn.popover.Constructor.prototype.leave;
  $.fn.popover.Constructor.prototype.leave = function(obj){
    var self = obj instanceof this.constructor ?
      obj : $(obj.currentTarget)[this.type](this.getDelegateOptions()).data('bs.' + this.type)
    var container, timeout;

    originalLeave.call(this, obj);

    if(obj.currentTarget) {
      container = self.$tip
      timeout = self.timeout;
      container.one('mouseenter', function(){
        clearTimeout(timeout);
        container.one('mouseleave', function(){
          $.fn.popover.Constructor.prototype.leave.call(self, self);
        });
      })
    }
  };

  $('.js-series').popover({
    html: true,
    content: function(){
      return $(this).siblings('.popover-content-holder').html()
    },
    trigger: 'hover',
    placement: 'auto right',
    container: 'body',
    viewport: { 'selector': 'body', 'padding': 0 },
    delay: 300,
    template: '<div class="popover popover-close" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'
  })
</script>